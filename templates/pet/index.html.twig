{% extends 'base.html.twig' %}

{% block page_title %}Listagem de Pets{% endblock %}

{% block body %}
<div class="container">

    <div class="pagetitle">
        <h1>Listagem de Pets
        <a class="me-5 btn btn-primary btm-sm float-end" href="{{ url('pet_novo') }}"><span class="icon-base bx bx-plus icon-sm me-2"></span> Novo Pet</a>
        </h1>
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{url('home')}}">Home</a></li>
                <li class="breadcrumb-item">Atendimento</li>
                <li class="breadcrumb-item active">Pets</li>
            </ol>
        </nav>
    </div>

    <div class="tabela-container container-fluid px-2">
        
        <div class="text-end mb-3">
            
        </div>
        <div id="cardContainerPets" class="row gy-3">

{% for pet in pets %}
<div class="col-12 card-items" data-search="{{ pet.nome }} {{ pet.dono_nome }} {{ pet.especie }} {{ pet.raca }}">

<div class="card pet-card border-0 rounded-4 shadow-sm">
    <div class="card-body p-3">

        <div class="row align-items-center g-3">

            <!-- Avatar -->
            <div class="col-auto">
                <div class="pet-avatar">
                    <i class="bx bx-paw"></i>
                </div>
            </div>

            <!-- Conteúdo -->
            <div class="col">

                <h5 class="mb-1 fw-semibold text-primary">
                    <a href="#" class="text-primary abrir-modal-pet text-decoration-none"
                       data-bs-toggle="offcanvas"
                       data-bs-target="#offcanvasPet"
                       aria-controls="offcanvasPet"
                       data-id="{{ pet.id }}">
                        {{ pet.nome }}
                    </a>
                    <span class="text-muted fs-6">— {{ pet.dono_nome }}</span>
                </h5>

                <div class="d-flex flex-wrap gap-3 text-muted small mt-1">
                    <span>{{ pet.especie|especie|raw }} {{ pet.especie }}</span>
                    <span><b>Raça:</b> {{ pet.raca }}</span>
                    <span>{{ pet.sexo }}</span>
                    <span><b>Porte:</b> {{ pet.porte }}</span>
                    <span><b>Idade:</b> {{ pet.idade }} anos</span>
                </div>

                <div class="mt-2">
                    {% if pet.observacoes %}
                        <span class="bg-warning-subtle text-warning-emphasis px-3 py-2 rounded-3">
                            <i class="bx bx-error-circle"></i> {{ pet.observacoes }}
                        </span>
                    {% else %}
                        <span class="bg-light text-muted px-3 py-2 rounded-3">
                            Sem observações
                        </span>
                    {% endif %}
                </div>

            </div>

            <!-- Ações -->
            <div class="col-auto">
                <div class="dropdown dropstart">
                    <button class="btn btn-outline-secondary rounded-pill px-4" data-bs-toggle="dropdown">
                        <i class="bx bx-dots-vertical-rounded"></i> Ação
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end shadow-sm border-0 rounded-3">
                        <li>
                            <a href="{{ path('pet_editar', {'id': pet.id}) }}" class="dropdown-item">
                                Editar
                            </a>
                        </li>
                        <li>
                            <form method="post" action="{{ path('pet_deletar', {'id': pet.id}) }}">
                                <button type="submit" class="dropdown-item text-danger"
                                        onclick="return confirm('Tem certeza que deseja deletar este pet?')">
                                    Deletar
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>
            </div>

        </div>
    </div>
</div>

</div>
{% else %}
<div class="col-12">
    <div class="alert alert-info text-center mb-0">Nenhum pet encontrado.</div>
</div>
{% endfor %}

</div>

        <div class="row mt-4">
            <div class="col text-center">
                <nav aria-label="Paginação">
                    <ul id="paginationPets" class="pagination justify-content-center mb-0"></ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="abrir-modal-pet" aria-labelledby="abrir-modal-petLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="abrir-modal-petLabel">Backdrop with scrolling</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <p>Try scrolling the rest of the page to see this option in action.</p>
  </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script src="{{ asset('js/TabelaDefault.js') }}"></script>
<script>
const offcanvasElementList = document.querySelectorAll('.offcanvas')
const offcanvasList = [...offcanvasElementList].map(offcanvasEl => new bootstrap.Offcanvas(offcanvasEl))

$('#searchInput').attr('id','searchInputPets');

document.addEventListener('DOMContentLoaded', function () {
    new TabelaDefault({
        cardContainerId: 'cardContainerPets',
        paginationId: 'paginationPets',
        searchInputId: 'searchInputPets',
        itemsPerPage: 5 // Troca se quiser mais/menos por página
    });

    // Exemplo de JS para abrir modal detalhado do pet (adapta pro seu AJAX se precisar)
    document.querySelectorAll('.abrir-modal-pet').forEach(function (el) {
        el.addEventListener('click', function (e) {
            // Aqui você faz seu fetch pra detalhes do pet e preenche o modal
        });
    });
});
</script>
{% endblock %}
