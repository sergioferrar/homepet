{% extends 'base.html.twig' %}
{% block title %}Relat√≥rio de Vendas{% endblock %}

{% block body %}
    <div class="pagetitle">
        <h1>Relat√≥rio de Vendas
            <a class="me-md-5 mt-sm-3 btn btn-primary btm-sm mb-3 float-md-end"
               href="{{ url('clinica_pdv_index') }}">
                <i class="bi bi-arrow-left me-1"></i>Voltar
            </a>
        </h1>
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url('home') }}">Home</a></li>
                <li class="breadcrumb-item">Atendimento</li>
                <li class="breadcrumb-item">PDV</li>
                <li class="breadcrumb-item active">Relat√≥rio de Vendas</li>
            </ol>
        </nav>
    </div>

    {# Flash messages #}
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{ label == 'danger' ? 'danger' : (label == 'warning' ? 'warning' : 'success') }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endfor %}

    <div class="container-fluid bg-white p-4 mt-4 rounded shadow-sm">

        <!-- üîπ Barra de navega√ß√£o -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <a href="{{ path('clinica_pdv_index') }}" class="btn btn-outline-primary me-2">
                    <i class="bi bi-cash-coin"></i> PDV
                </a>
                <a href="{{ path('clinica_pdv_caixa') }}" class="btn btn-outline-success">
                    <i class="bi bi-wallet2"></i> Fechamento de Caixa
                </a>
            </div>
        </div>
        <hr>

        <table class="table table-striped table-hover align-middle">
            <thead class="table-light">
            <tr>
                <th>#ID</th>
                <th>Data</th>
                <th>Cliente</th>
                <th>Valor</th>
                <th>Forma de Pagamento</th>
                <th>Status</th>
                <th class="text-center">A√ß√µes</th>
            </tr>
            </thead>
            <tbody>
            {% for v in vendas %}
                <tr>
                    <td>{{ v.id }}</td>
                    <td>{{ v.data|date('d/m/Y H:i') }}</td>
                    <td>{{ v.cliente }}</td>
                    <td>R$ {{ v.total|number_format(2, ',', '.') }}</td>
                    <td>{{ v.metodoPagamento|upper }}</td>
                    <td>
                        {# Badge colorido por status #}
                        {% if v.status in ['aberto', 'Carrinho', 'carrinho'] %}
                            <span class="badge bg-warning text-dark">{{ v.status|capitalize }}</span>
                        {% elseif v.status in ['finalizado', 'Finalizado'] %}
                            <span class="badge bg-success">Finalizado</span>
                        {% elseif v.status in ['cancelado', 'Cancelado', 'inativo'] %}
                            <span class="badge bg-danger">{{ v.status|capitalize }}</span>
                        {% else %}
                            <span class="badge bg-secondary">{{ v.status }}</span>
                        {% endif %}
                    </td>
                    <td class="text-center">
                        {# ‚úÖ Bot√£o "Lan√ßar no Caixa" ‚Äî apenas para vendas abertas/carrinho #}
                        {% if v.status in ['Aberta', 'Carrinho', 'carrinho'] %}
                            <a href="{{ path('pdv_carregar', {id: v.id}) }}"
                               class="btn btn-success btn-sm"
                               title="Lan√ßar esta venda no PDV para finaliza√ß√£o">
                                <i class="bi bi-cash-stack me-1"></i>Lan√ßar no Caixa
                            </a>
                        {% else %}
                            <span class="text-muted small">‚Äî</span>
                        {% endif %}
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="7" class="text-center text-muted py-4">
                        <i class="bi bi-inbox fs-4 d-block mb-2"></i>
                        Nenhuma venda encontrada.
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}
