{% extends 'base.html.twig' %}

{% block title %}Emitir Receita - {{ pet.nome }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
{% endblock %}

{% block body %}
<div class="container my-5">
    <div class="card shadow-sm">
        <div class="card-header text-white" style="background-color: #6610f2;">
            <h4 class="mb-0"><i class="bx bxs-pencil me-2"></i>Emitir Receita</h4>
        </div>
        <div class="card-body p-4">
            <div class="p-3 mb-4 bg-light border rounded">
                <h5>Pet: <strong>{{ pet.nome }} ({{ pet.id }})</strong></h5>
            </div>
            <form method="post" id="form-receita" target="_blank">
                <input type="hidden" name="cabecalho" id="input-cabecalho">
                <input type="hidden" name="conteudo" id="input-conteudo">
                <input type="hidden" name="rodape" id="input-rodape">

                <div class="mb-3">
                    <label class="form-label"><strong>Cabeçalho:</strong></label>
                    <div id="editor-cabecalho" style="min-height: 100px;"></div>
                </div>
                <div class="mb-3">
                    <label class="form-label"><strong>Receita:</strong></label>
                    <div id="editor-conteudo" style="min-height: 250px;"></div>
                </div>
                <div class="mb-3">
                    <label class="form-label"><strong>Rodapé:</strong></label>
                    <div id="editor-rodape" style="min-height: 100px;"></div>
                </div>
                <div class="d-flex justify-content-end mt-4">
                    <a href="{{ path('clinica_detalhes_pet', {'id': pet.id}) }}" class="btn btn-secondary me-2">Voltar</a>
                    <button type="submit" class="btn btn-primary"><i class='bx bxs-printer me-1'></i>Imprimir / Salvar PDF</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const quillOptions = { theme: 'snow' };
            const editorCabecalho = new Quill('#editor-cabecalho', quillOptions);
            const editorConteudo = new Quill('#editor-conteudo', quillOptions);
            const editorRodape = new Quill('#editor-rodape', quillOptions);

            // Valores padrão
            editorCabecalho.root.innerHTML = `<h2>Nome do Veterinário(a)</h2><p>CRMV - Especialidade</p>`;
            editorRodape.root.innerHTML = `<p><strong>Data:</strong> {{ "now"|date("d/m/Y") }}</p>`;

            const form = document.getElementById('form-receita');
            form.addEventListener('submit', function() {
                document.getElementById('input-cabecalho').value = editorCabecalho.root.innerHTML;
                document.getElementById('input-conteudo').value = editorConteudo.root.innerHTML;
                document.getElementById('input-rodape').value = editorRodape.root.innerHTML;
            });
        });
    </script>
{% endblock %}
